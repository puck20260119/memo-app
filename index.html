<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¢</title>

<style>
:root {
  --bg: #ffffff;
  --text: #222222;
  --card: #f5f5f5;
  --accent: #4a90e2;
}

/* ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨å¤‰æ•° */
body.dark {
  --bg: #121212;
  --text: #eeeeee;
  --card: #1e1e1e;
  --accent: #5aa9ff;
}

body {
  font-family: sans-serif;
  max-width: 600px;
  margin: 30px auto;
  padding: 10px;
  background: var(--bg);
  color: var(--text);
  transition: 0.3s;
}

h1 { text-align: center; }

#theme {
  width: 100%;
  font-size: 18px;
  padding: 10px;
  box-sizing: border-box;
  background: var(--card);
  color: var(--text);
  border: 1px solid #ccc;
}

textarea {
  width: 100%;
  height: 200px;
  margin-top: 8px;
  font-size: 16px;
  padding: 10px;
  box-sizing: border-box;
  background: var(--card);
  color: var(--text);
  border: 1px solid #ccc;
}

select, button {
  margin-top: 8px;
  padding: 8px;
  font-size: 14px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 6px;
}

li {
  margin-bottom: 10px;
  background: var(--card);
  padding: 8px;
  border-radius: 6px;
}

.delete-btn {
  font-size: 12px;
  margin-left: 10px;
  background: #e74c3c;
}

#app { display: none; }

#lockScreen {
  text-align: center;
  margin-top: 100px;
}

#lockScreen input {
  font-size: 20px;
  text-align: center;
  width: 120px;
  padding: 8px;
}

/* ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ */
#modeToggle {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--card);
  color: var(--text);
  border: 1px solid #aaa;
}
</style>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a90e2">
<link rel="apple-touch-icon" href="icon.png">
</head>
<body>

<button id="modeToggle">ğŸŒ™</button>

<!-- ğŸ”’ ãƒ­ãƒƒã‚¯ç”»é¢ -->
<div id="lockScreen">
  <h2>ğŸ”’ ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›</h2>
  <input type="password" id="passInput" maxlength="4" placeholder="4æ¡">
  <br><br>
  <button onclick="unlock()">å…¥å®¤</button>
  <p id="lockMsg" style="color:red;"></p>
</div>

<!-- ğŸŒ ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
<div id="app">
  <h1>â˜ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¢</h1>

  <input id="theme" placeholder="ãƒ†ãƒ¼ãƒ">

  <select id="status">
    <option value="draft">ä¸‹æ›¸ã</option>
    <option value="published">å…¬é–‹æ¸ˆã¿</option>
  </select>

  <textarea id="text" placeholder="ã“ã“ã«ãƒ¡ãƒ¢"></textarea>
  <button onclick="saveMemo()">ä¿å­˜</button>

  <hr>

  <button onclick="setFilter('all')">ã™ã¹ã¦</button>
  <button onclick="setFilter('draft')">ä¸‹æ›¸ã</button>
  <button onclick="setFilter('published')">å…¬é–‹æ¸ˆã¿</button>

  <ul id="memoList"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”‘ ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ */
const PASSCODE = "1212";

window.unlock = () => {
  const input = document.getElementById("passInput").value;
  if (input === PASSCODE) {
    document.getElementById("lockScreen").style.display = "none";
    document.getElementById("app").style.display = "block";
    startApp();
  } else {
    document.getElementById("lockMsg").textContent = "ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
  }
};

/* ğŸ”¥ Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyABRqabTZH_2lxSgPK8zfF_IY0MDXRvHOw",
  authDomain: "memo-sync-65e5f.firebaseapp.com",
  projectId: "memo-sync-65e5f",
  storageBucket: "memo-sync-65e5f.firebasestorage.app",
  messagingSenderId: "1044879277772",
  appId: "1:1044879277772:web:60440696265ebb11efcc69"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let memosRef;
let memos = [];
let currentFilter = "all";
let editingId = null;

function startApp() {
  memosRef = collection(db, "memos");
  onSnapshot(memosRef, (snapshot) => {
    memos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    render();
  });
}

window.setFilter = (f) => { currentFilter = f; render(); };

window.saveMemo = async () => {
  if (!memosRef) return;
  const theme = document.getElementById("theme").value.trim();
  const text = document.getElementById("text").value;
  const status = document.getElementById("status").value;
  if (!theme) return;

  if (editingId) {
    await updateDoc(doc(db, "memos", editingId), { theme, text, status });
    editingId = null;
  } else {
    await addDoc(memosRef, { theme, text, status, created: Date.now() });
  }
  clearEditor();
};

function clearEditor() {
  theme.value = "";
  text.value = "";
  status.value = "draft";
}

function render() {
  memoList.innerHTML = "";
  memos.forEach((memo) => {
    if (currentFilter !== "all" && memo.status !== currentFilter) return;

    const li = document.createElement("li");
    const span = document.createElement("span");
    span.textContent = `${memo.status === "published" ? "ğŸŒ" : "ğŸ“"} ${memo.theme}`;
    span.style.cursor = "pointer";
    span.onclick = () => loadMemo(memo);

    const del = document.createElement("button");
    del.textContent = "ğŸ—‘";
    del.className = "delete-btn";
    del.onclick = async () => await deleteDoc(doc(db, "memos", memo.id));

    li.appendChild(span);
    li.appendChild(del);
    memoList.appendChild(li);
  });
}

function loadMemo(memo) {
  theme.value = memo.theme;
  text.value = memo.text;
  status.value = memo.status;
  editingId = memo.id;
}

/* ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡ */
const toggleBtn = document.getElementById("modeToggle");

// ç«¯æœ«è¨­å®šã‚’åˆæœŸåæ˜ 
if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.body.classList.add("dark");
}

toggleBtn.onclick = () => {
  document.body.classList.toggle("dark");
  toggleBtn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
};
</script>

</body>
</html>


