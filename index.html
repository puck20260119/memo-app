<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¢</title>

  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 30px auto;
      padding: 10px;
    }

    /* â† ãƒ†ãƒ¼ãƒæ¬„ã‚’æ¨ªã„ã£ã±ã„ã« */
    #theme {
      width: 110%;
      font-size: 18px;
      padding: 10px;
      box-sizing: border-box;
    }

    /* â† ãƒ¡ãƒ¢æ¬„ã‚’å¤§ãã */
    textarea {
      width: 100%;
      height: 200px;
      margin-top: 8px;
      font-size: 16px;
      padding: 10px;
      box-sizing: border-box;
    }

    select, button {
      margin-top: 8px;
      padding: 8px;
      font-size: 14px;
    }

    li { margin-bottom: 10px; }

    .delete-btn {
      font-size: 12px;
      margin-left: 10px;
    }

    #app { display: none; }

    #lockScreen {
      text-align: center;
      margin-top: 100px;
    }

    #lockScreen input {
      font-size: 20px;
      text-align: center;
      width: 120px;
      padding: 8px;
    }
  </style>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4a90e2">
  <link rel="apple-touch-icon" href="icon.png">
</head>
<body>

<!-- ğŸ”’ ãƒ­ãƒƒã‚¯ç”»é¢ -->
<div id="lockScreen">
  <h2>ğŸ”’ ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›</h2>
  <input type="password" id="passInput" maxlength="4" placeholder="4æ¡">
  <br><br>
  <button onclick="unlock()">å…¥å®¤</button>
  <p id="lockMsg" style="color:red;"></p>
</div>

<!-- ğŸŒ ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
<div id="app">
  <h1>â˜ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¢</h1>

  <input id="theme" placeholder="ãƒ†ãƒ¼ãƒ">

  <select id="status">
    <option value="draft">ä¸‹æ›¸ã</option>
    <option value="published">å…¬é–‹æ¸ˆã¿</option>
  </select>

  <textarea id="text" placeholder="ã“ã“ã«ãƒ¡ãƒ¢"></textarea>
  <button onclick="saveMemo()">ä¿å­˜</button>

  <hr>

  <button onclick="setFilter('all')">ã™ã¹ã¦</button>
  <button onclick="setFilter('draft')">ä¸‹æ›¸ã</button>
  <button onclick="setFilter('published')">å…¬é–‹æ¸ˆã¿</button>

  <ul id="memoList"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  deleteDoc,
  doc,
  onSnapshot,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”‘ å¥½ããª4æ¡ã«å¤‰æ›´OK */
const PASSCODE = "5526";

window.unlock = () => {
  const input = document.getElementById("passInput").value;
  if (input === PASSCODE) {
    document.getElementById("lockScreen").style.display = "none";
    document.getElementById("app").style.display = "block";
    startApp();
  } else {
    document.getElementById("lockMsg").textContent = "ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
  }
};

const firebaseConfig = {
  apiKey: "AIzaSyABRqabTZH_2lxSgPK8zfF_IY0MDXRvHOw",
  authDomain: "memo-sync-65e5f.firebaseapp.com",
  projectId: "memo-sync-65e5f",
  storageBucket: "memo-sync-65e5f.firebasestorage.app",
  messagingSenderId: "1044879277772",
  appId: "1:1044879277772:web:60440696265ebb11efcc69"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let memosRef;
let memos = [];
let currentFilter = "all";
let editingId = null;

function startApp() {
  memosRef = collection(db, "memos");

  onSnapshot(memosRef, (snapshot) => {
    memos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    render();
  });
}

window.setFilter = (f) => {
  currentFilter = f;
  render();
};

window.saveMemo = async () => {
  if (!memosRef) return;

  const theme = document.getElementById("theme").value.trim();
  const text = document.getElementById("text").value;
  const status = document.getElementById("status").value;
  if (!theme) return;

  if (editingId) {
    await updateDoc(doc(db, "memos", editingId), { theme, text, status });
    editingId = null;
  } else {
    await addDoc(memosRef, { theme, text, status, created: Date.now() });
  }

  clearEditor();
};

function clearEditor() {
  document.getElementById("theme").value = "";
  document.getElementById("text").value = "";
  document.getElementById("status").value = "draft";
}

function render() {
  const list = document.getElementById("memoList");
  list.innerHTML = "";

  memos.forEach((memo) => {
    if (currentFilter !== "all" && memo.status !== currentFilter) return;

    const li = document.createElement("li");

    const span = document.createElement("span");
    span.textContent = `${memo.status === "published" ? "ğŸŒ" : "ğŸ“"} ${memo.theme}`;
    span.style.cursor = "pointer";
    span.onclick = () => loadMemo(memo);

    const del = document.createElement("button");
    del.textContent = "ğŸ—‘";
    del.className = "delete-btn";
    del.onclick = async () => {
      await deleteDoc(doc(db, "memos", memo.id));
    };

    li.appendChild(span);
    li.appendChild(del);
    list.appendChild(li);
  });
}

function loadMemo(memo) {
  document.getElementById("theme").value = memo.theme;
  document.getElementById("text").value = memo.text;
  document.getElementById("status").value = memo.status;
  editingId = memo.id;
}
</script>

</body>
</html>

